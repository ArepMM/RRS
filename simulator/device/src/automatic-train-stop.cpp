#include    "automatic-train-stop.h"

#include    <QLibrary>

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
AutoTrainStop::AutoTrainStop(QObject *parent) : BrakeDevice(parent)
  , is_powered(0.0)
  , is_key_on(0.0)
  , pFL(0.0)
  , pBP(0.0)
  , QFL(0.0)
  , QBP(0.0)
{

}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
AutoTrainStop::~AutoTrainStop()
{

}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void AutoTrainStop::setKeyOn(bool state)
{
    is_key_on = static_cast<double>(state);
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
bool AutoTrainStop::isKeyOn() const
{
    return static_cast<bool>(is_key_on);
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void AutoTrainStop::setPowered(bool state)
{
    is_powered = static_cast<double>(state);
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
bool AutoTrainStop::isPowered() const
{
    return static_cast<bool>(is_powered);
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
bool AutoTrainStop::getEmergencyBrakeContact() const
{
    return false;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void AutoTrainStop::setFLpressure(double value)
{
    pFL = value;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
double AutoTrainStop::getFLflow() const
{
    return QFL;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void AutoTrainStop::setBPpressure(double value)
{
    pBP = value;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
double AutoTrainStop::getBPflow() const
{
    return QBP;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
AutoTrainStop *loadAutoTrainStop(QString lib_path)
{
    AutoTrainStop *autostop = nullptr;

    QLibrary lib(lib_path);

    if (lib.load())
    {
        GetAutoTrainStop getAutoTrainStop = reinterpret_cast<GetAutoTrainStop>(lib.resolve("getAutoTrainStop"));

        if (getAutoTrainStop)
        {
            autostop = getAutoTrainStop();
        }
    }

    return autostop;
}

#include    "pneumo-anglecock.h"

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
PneumoAngleCock::PneumoAngleCock(QObject *parent) : BrakeDevice(parent)
  , p_pipe(0.0)
  , p_hose(0.0)
  , Q_pipe(0.0)
  , Q_hose(0.0)
  , k(1.0)
  , is_opened(true)
{

}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
PneumoAngleCock::~PneumoAngleCock()
{

}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void PneumoAngleCock::setP_pipe(double p)
{
    this->p_pipe = p;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void PneumoAngleCock::setP_hose(double p)
{
    this->p_hose = p;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void PneumoAngleCock::setState(bool opened)
{
    this->is_opened = opened;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
double PneumoAngleCock::getQ_pipe() const
{
    return Q_pipe;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
double PneumoAngleCock::getQ_hose() const
{
    return Q_hose;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
bool PneumoAngleCock::getState() const
{
    return is_opened;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void PneumoAngleCock::preStep(state_vector_t &Y, double t)
{
    Q_UNUSED(Y)
    Q_UNUSED(t)

    if (is_opened)
    // Открытый концевой кран
    {
        // Рукав соединён с магистралью
        double Q = k * (p_hose - p_pipe);
        Q_pipe = Q;
        Q_hose = -Q;
    }
    else
    // Закрытый концевой кран
    {
        // Магистраль перекрыта
        Q_pipe = 0.0;
        // Рукав соединён с атмосферой
        Q_hose = k * p_hose;
    }
}
